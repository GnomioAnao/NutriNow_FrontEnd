<div clas="chatbot-container fade-in-up delay-2">
  <div class="nutri-chat-root">
    <!-- Animated gradient background + soft shapes -->
    <div class="bg-wrap" aria-hidden="true">
      <div class="bg-shape shape-1"></div>
      <div class="bg-shape shape-2"></div>
      <div class="bg-shape shape-3"></div>
      <div class="bg-glow"></div>
    </div>

    <!-- Chat card -->
    <div class="chat-card">
      <!-- Header -->
      <header class="chat-top">
        <div class="top-left">
          <div class="mascot-box">
            <img src="assets/nutria-mascote.png" alt="NutriA" class="mascot-img" />
          </div>
          <div class="title-area">
            <h1 class="chat-title">Chat com NutriA</h1>
            <p class="chat-sub">Sua assistente de nutrição inteligente</p>
          </div>
        </div>

        <div class="top-right">
          <button class="logout" (click)="logout()" title="Sair">
            <!-- simple icon -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M16 17l5-5-5-5" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M21 12H9" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M13 19H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h8" stroke-width="1.6" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            Sair
          </button>
        </div>
      </header>

      <!-- Messages area -->
      <section class="messages-area" #messagesContainer>
        <ng-container *ngFor="let msg of messages">
          <div class="msg-row" [ngClass]="{ 'msg-user': msg.isUser, 'msg-bot': !msg.isUser }">
            <!-- avatar left for bot -->
            <div class="msg-avatar" *ngIf="!msg.isUser">
              <img src="assets/nutria-mascote.png" alt="NutriA" />
            </div>

            <!-- message bubble -->
            <div class="msg-bubble">
              <div class="msg-text" [innerHTML]="formatMessage(msg.text)"></div>
              <div class="msg-time">{{ msg.timestamp | date:'HH:mm' }}</div>
            </div>

            <!-- simple user avatar placeholder on right -->
            <div class="msg-avatar user-avatar" *ngIf="msg.isUser">
              <div class="user-initial">N</div>
            </div>
          </div>
        </ng-container>

        <!-- Typing / loading indicator -->
        <div class="msg-row typing-row" *ngIf="loading">
          <div class="msg-avatar">
            <img src="assets/nutria-mascote.png" alt="NutriA" />
          </div>
          <div class="msg-bubble typing">
            <div class="typing-dots" aria-hidden="true">
              <span></span><span></span><span></span>
            </div>
            <div class="msg-time">...</div>
          </div>
        </div>
      </section>

      <!-- Input area -->
      <footer class="chat-input-area">
        <!-- file upload -->
        <label class="file-label" for="fileInput" title="Enviar imagem">
          <input id="fileInput" type="file" accept="image/*" (change)="onFileSelected($event)" hidden />
          <!-- clip SVG -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path
              d="M21.44 11.05 12.7 19.79a4.5 4.5 0 0 1-6.36-6.36l8.74-8.74a3.25 3.25 0 1 1 4.6 4.6L11 17.24a1.5 1.5 0 0 1-2.12-2.12l7.68-7.68"
              stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </label>

        <input class="input-field" type="text" placeholder="Pergunte sobre nutrição, exercícios, receitas..."
          [(ngModel)]="currentMessage" (keydown.enter)="sendMessage()" [disabled]="loading" aria-label="Mensagem" />

        <button class="send-btn" (click)="sendMessage()" [disabled]="!currentMessage.trim() || loading" title="Enviar">
          <!-- paper plane svg -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M22 2 11 13" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
              stroke-linejoin="round" />
            <path d="M22 2 15 22l-4-9-9-4 20-7z" stroke="currentColor" stroke-width="1" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        </button>
      </footer>
    </div>
  </div>
</div>